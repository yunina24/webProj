<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>upload.html</title>
<style>
    #img {
        height: 220;
        width: 180;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function(){
        //DB 데이타를 화면에 출력...<div><table></table></div>
        $.ajax({
            url: 'getFileListServlet',
            dataType: 'json',
            success: function(){
				//table을 활용하여 리스트 출력...
            	let tbl = $('<table />');
                tbl.attr('border', '1');
                let tr = $('<tr />');
                tr.append(
                        $('<td />').html(num),
                        $('<td />').html(author),
                        $('<td />').html(title),
                        $('<td />').html(file_name),
                        $('<td />').html(day)
                    	);
                    	return tr;
                $('#tbl').html();
            },
            error: function(){

            }
        });

    	//파일을 선택하면 이미지를 나타나도록...
        $('#filename').change(function(){
            for(let file of this.files){
                $('#img').attr('src', URL.createObjectURL(file));
            }
        });
    	
    	//전송을 누르면...
    	$('#frm').submit(function(e){
    		e.preventDefault();
    		let frm = document.getElementById('frm');
    		let data = new FormData(frm);
    		for(let k of data.entries()){
    			console.log(k);
    		}
    		
    		//비동기 호출... 파일업로드 서블릿...
    		$.ajax({
    			contentType: false,
    			processData: false,
    			url: $('#frm').attr('action'),
    			type: 'post',
    			dataType: 'json',
    			data: data,
    			success: function(result){
    				console.log(result);
    			},
    			error: function(err){
    				console.log(err);
    			}
    		});
    	});
    });
</script>
</head>
<body>
<h1> Ajax 파일 업로드 </h1>
<form id ='frm' action="../FileUploadServlet" method ='post' enctype="multipart/form-data">
<div id = "show"></div> 
    <table border="1">
        <tr>
            <td><label for="num">번 호</label></td>
            <td><input type="text" name="num" id="num"></td>
            <td rowspan="4"><img src="" alt="선택한 파일." id="img"></td>
        </tr>
        <tr>
            <td><label for="author">저 자</label></td>
            <td><input type="text" name="author" id="author"></td>
        </tr>
        <tr>
            <td><label for="title">제 목</label></td>
            <td><input type="text" name="title" id="title"></td>
        </tr>
        <tr>
            <td><label for="filename">파일첨부</label></td>
            <td><input type="file" name="filename" id="filename"></td>
        </tr>
        <tr>
            <td colspan="3"><input type="submit"><input type="reset"></td>
        </tr>
    </table>
    <!-- 이름: <input type="text" name="name" value = '홍길동'><br>
    파일: <input type="file" name="file1"><br>
    파일: <input type="file" name="file2"><br>
    <input type="submit" value="전송"> -->
    
</form>
</body>
</html>